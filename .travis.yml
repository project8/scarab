language: cpp

stages:
- name: Testing
  if: branch = main OR 
    branch = develop OR 
    branch =~ /.*\.(?i:build)$/ OR 
    branch = feature/testing OR
    type = pull_request 

jobs:
  include:
  - stage: Testing
    os: osx
    compiler: clang
    osx_image: xcode11.3
    addons:
      homebrew:
        packages:
        - rapidjson
        - yaml-cpp
        - pybind11
        update: true
    before_install:
    - mkdir build
    install:
    - cd build
    - cmake .. -DScarab_ENABLE_TESTING=TRUE
    - make install
    script: testing/run_tests
  - stage: Testing
    os: linux
    dist: buster
    compiler: gcc
    addons:
      apt:
        sources:
        - ubuntu-toolchain-r-test
        packages:
        - g++-5
        - libboost-all-dev
        - rapidjson-dev
        - libyaml-cpp-dev
        - pybind11-dev
    before_install:
    - cmake --version
    - export CC=gcc-5 && export CXX=g++-5
    - mkdir build
    install:
    - cd build
    - cmake .. -DScarab_ENABLE_TESTING=TRUE
    - make install
    script: testing/run_tests
  - stage: Testing
    os: linux
    dist: buster
    compiler: clang
    addons:
      apt:
        sources:
        - ubuntu-toolchain-r-test
        packages:
        - clang
        - libboost-all-dev
        - rapidjson-dev
        - libyaml-cpp-dev
        - pybind11-dev
    before_install:
    - export CC=clang && export CXX=clang++
    - mkdir build
    install:
    - cd build
    - cmake .. -DScarab_ENABLE_TESTING=TRUE
    - make
    script: testing/run_tests
